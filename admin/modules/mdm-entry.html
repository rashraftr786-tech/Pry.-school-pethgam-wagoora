<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MDM Management System | GPS Pethgam</title>
    <style>
        :root {
            --primary-color: #1a202c;
            --border-color: #000;
        }

        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f7fafc;
            margin: 0;
            padding: 20px;
        }

        .no-print {
            max-width: 1000px;
            margin: 0 auto 30px auto;
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h2.section-title {
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-top: 0;
            color: #2d3748;
            font-size: 18px;
        }

        .form-grid {
            display: grid;
            grid-template-cols: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 5px;
            text-transform: uppercase;
            color: #4a5568;
        }

        input, select {
            padding: 8px;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            font-size: 14px;
        }

        .config-box {
            background-color: #f0fff4;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 5px solid #38a169;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            transition: opacity 0.2s;
        }

        .btn-save { background: #38a169; color: white; }
        .btn-config { background: #3182ce; color: white; }
        .btn-generate { background: #2d3748; color: white; }
        .btn-reset { background: #e53e3e; color: white; }

        /* A4 Page Styling */
        .a4-page {
            width: 210mm;
            min-height: 297mm;
            padding: 10mm;
            margin: 10mm auto;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
            position: relative;
        }

        .header {
            text-align: center;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .header h1 { margin: 5px 0; font-size: 20px; text-transform: uppercase; }
        .header h3 { margin: 5px 0; font-size: 14px; font-weight: normal; font-style: italic; }
        .header h2 { margin: 10px 0; font-size: 16px; text-decoration: underline; }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 10px;
        }

        th, td {
            border: 1px solid #000;
            padding: 4px;
            text-align: center;
        }

        th { background-color: #f2f2f2; }

        .signature-space {
            margin-top: 50px;
            display: flex;
            justify-content: space-between;
        }

        .sig-box {
            border-top: 1px solid #000;
            width: 200px;
            text-align: center;
            padding-top: 5px;
            font-weight: bold;
            font-size: 12px;
        }

        @media print {
            body { background: none; padding: 0; }
            .no-print { display: none; }
            .a4-page { margin: 0; box-shadow: none; width: 100%; height: auto; }
        }
    </style>
</head>
<body>

    <div class="no-print">
        <div class="config-box">
            <h2 class="section-title">‚öôÔ∏è Monthly Settings (Fixed Values)</h2>
            <p style="font-size: 12px; color: #4a5568; margin-bottom: 15px;">Define rates, cook counts, and opening balances here once per month.</p>
            <div class="form-grid">
                <div class="form-group">
                    <label>PP Total Roll</label>
                    <input type="number" id="ppRoll" placeholder="0">
                </div>
                <div class="form-group">
                    <label>Primary Total Roll</label>
                    <input type="number" id="pRoll" placeholder="0">
                </div>
                <div class="form-group">
                    <label>PP Rate/Student (‚Çπ)</label>
                    <input type="number" step="0.01" id="ppRate" placeholder="5.45">
                </div>
                <div class="form-group">
                    <label>Pri. Rate/Student (‚Çπ)</label>
                    <input type="number" step="0.01" id="pRate" placeholder="8.17">
                </div>
                <div class="form-group">
                    <label>Rice Opening (kg)</label>
                    <input type="number" step="0.001" id="riceOpening" placeholder="0.000">
                </div>
                <div class="form-group">
                    <label>Rice Lifted (kg)</label>
                    <input type="number" step="0.001" id="riceLifted" placeholder="0.000">
                </div>
                <div class="form-group">
                    <label>Funds Opening (‚Çπ)</label>
                    <input type="number" step="0.01" id="fundsOpening" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label>Funds Received (‚Çπ)</label>
                    <input type="number" step="0.01" id="fundsReceived" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label>No. of Cooks</label>
                    <input type="number" id="numCooks" value="1">
                </div>
            </div>
            <button class="btn-config" onclick="saveMonthlySettings()">Update Monthly Settings</button>
        </div>

        <h2 class="section-title">üìÖ Daily MDM Entry</h2>
        <div class="form-grid">
            <div class="form-group">
                <label>Date</label>
                <input type="date" id="dailyDate">
            </div>
            <div class="form-group">
                <label>Scheme Type</label>
                <select id="schemeType">
                    <option value="Pre-Primary">Pre-Primary (Bal Vatika)</option>
                    <option value="Primary">Primary</option>
                </select>
            </div>
            <div class="form-group">
                <label>MDM Served Today?</label>
                <select id="mdmServed">
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                </select>
            </div>
            <div class="form-group">
                <label>Students Covered</label>
                <input type="number" id="studentsCovered" placeholder="0">
            </div>
        </div>
        
        <div class="btn-group">
            <button class="btn-save" onclick="saveDailyEntry()">Save Daily Entry</button>
            <button class="btn-generate" onclick="generateStatement()">Generate Monthly Statement</button>
            <button class="btn-reset" onclick="resetData()">Clear All Data</button>
        </div>

        <h3 style="margin-top:30px; font-size: 14px;">Recent Daily Records</h3>
        <table style="font-size: 12px; width: 100%; text-align: left;" id="dailyRecordsTable">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Scheme</th>
                    <th>Served</th>
                    <th>Covered</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="dailyRecordsBody"></tbody>
        </table>
    </div>

    <div class="a4-page" id="printableArea">
        <div class="header">
            <h3>OFFICE OF THE HEADMASTER</h3>
            <h1>GOVERNMENT PRIMARY SCHOOL PETHGAM WAGOORA</h1>
            <h2>Month Wise / Department Wise Expenditure Statement under MDM Scheme</h2>
            <p style="font-size: 12px; font-weight: bold;">Month: <span id="monthNameDisplay">________</span></p>
        </div>

        <table>
            <thead>
                <tr>
                    <th rowspan="2">Scheme</th>
                    <th rowspan="2">Total Roll</th>
                    <th rowspan="2">Working Days</th>
                    <th rowspan="2">Served Days</th>
                    <th rowspan="2">Students Covered</th>
                    <th rowspan="2">Meals Served</th>
                    <th colspan="4">Rice (Kgs)</th>
                    <th colspan="4">Cooking Cost Funds (‚Çπ)</th>
                    <th rowspan="2">No. of Cooks</th>
                </tr>
                <tr>
                    <th>Opening</th>
                    <th>Lifted</th>
                    <th>Utilized</th>
                    <th>Closing</th>
                    <th>Opening</th>
                    <th>Utilized</th>
                    <th>Received</th>
                    <th>Closing</th>
                </tr>
            </thead>
            <tbody id="statementTableBody"></tbody>
        </table>

        <div class="footer-section" style="margin-top: 30px; font-size: 12px;">
            <p><strong>MDM A/C:</strong> 0486040500000273 | <strong>Cook:</strong> SHAHEENA BANO (0486040100006054)</p>
            <div class="signature-space">
                <div class="sig-box">MDM Incharge</div>
                <div class="sig-box">Headmaster</div>
            </div>
        </div>
    </div>

    <div class="no-print" style="text-align: center; margin-bottom: 50px;">
        <button class="btn-print" onclick="window.print()">Print Statement (A4)</button>
    </div>

    <script>
        document.getElementById('dailyDate').valueAsDate = new Date();

        function getRecords() { return JSON.parse(localStorage.getItem('mdm_daily')) || []; }
        function getSettings() { return JSON.parse(localStorage.getItem('mdm_settings')) || { ppRoll:0, pRoll:0, ppRate:5.45, pRate:8.17, riceOpening:0, riceLifted:0, fundsOpening:0, fundsReceived:0, numCooks:1 }; }

        window.onload = function() {
            const s = getSettings();
            document.getElementById('ppRoll').value = s.ppRoll;
            document.getElementById('pRoll').value = s.pRoll;
            document.getElementById('ppRate').value = s.ppRate;
            document.getElementById('pRate').value = s.pRate;
            document.getElementById('riceOpening').value = s.riceOpening;
            document.getElementById('riceLifted').value = s.riceLifted;
            document.getElementById('fundsOpening').value = s.fundsOpening;
            document.getElementById('fundsReceived').value = s.fundsReceived;
            document.getElementById('numCooks').value = s.numCooks;
            updateDailyTable();
        };

        function saveMonthlySettings() {
            const settings = {
                ppRoll: parseInt(document.getElementById('ppRoll').value) || 0,
                pRoll: parseInt(document.getElementById('pRoll').value) || 0,
                ppRate: parseFloat(document.getElementById('ppRate').value) || 0,
                pRate: parseFloat(document.getElementById('pRate').value) || 0,
                riceOpening: parseFloat(document.getElementById('riceOpening').value) || 0,
                riceLifted: parseFloat(document.getElementById('riceLifted').value) || 0,
                fundsOpening: parseFloat(document.getElementById('fundsOpening').value) || 0,
                fundsReceived: parseFloat(document.getElementById('fundsReceived').value) || 0,
                numCooks: parseInt(document.getElementById('numCooks').value) || 1
            };
            localStorage.setItem('mdm_settings', JSON.stringify(settings));
            alert("Monthly Settings Updated!");
        }

        function saveDailyEntry() {
            const date = document.getElementById('dailyDate').value;
            const records = getRecords();
            const entry = {
                id: Date.now(),
                date: date,
                month: date.substring(0, 7),
                scheme: document.getElementById('schemeType').value,
                served: document.getElementById('mdmServed').value,
                covered: parseInt(document.getElementById('studentsCovered').value) || 0
            };
            records.push(entry);
            localStorage.setItem('mdm_daily', JSON.stringify(records));
            updateDailyTable();
            alert("Daily Entry Saved!");
        }

        function deleteEntry(id) {
            let records = getRecords().filter(r => r.id !== id);
            localStorage.setItem('mdm_daily', JSON.stringify(records));
            updateDailyTable();
        }

        function updateDailyTable() {
            const records = getRecords().sort((a,b) => b.date.localeCompare(a.date));
            const body = document.getElementById('dailyRecordsBody');
            body.innerHTML = '';
            records.slice(0, 10).forEach(r => {
                body.innerHTML += `<tr><td>${r.date}</td><td>${r.scheme}</td><td>${r.served}</td><td>${r.covered}</td><td><button onclick="deleteEntry(${r.id})" style="color:red; background:none; cursor:pointer;">[x]</button></td></tr>`;
            });
        }

        function generateStatement() {
            const targetMonth = document.getElementById('dailyDate').value.substring(0, 7);
            const records = getRecords().filter(r => r.month === targetMonth);
            const s = getSettings();
            
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            const d = new Date(targetMonth + "-01");
            document.getElementById('monthNameDisplay').innerText = monthNames[d.getMonth()] + " " + d.getFullYear();

            const body = document.getElementById('statementTableBody');
            body.innerHTML = '';

            const schemes = [
                { name: 'Pre-Primary', roll: s.ppRoll, rate: s.ppRate },
                { name: 'Primary', roll: s.pRoll, rate: s.pRate }
            ];

            let totalUtilizedRice = 0;
            let totalUtilizedFunds = 0;

            schemes.forEach((sc, idx) => {
                const sRecs = records.filter(r => r.scheme === sc.name);
                const wDays = new Set(sRecs.map(r => r.date)).size;
                const sDays = sRecs.filter(r => r.served === 'Yes').length;
                const covered = sRecs.reduce((acc, r) => acc + r.covered, 0);
                
                const utilRice = (covered * 100) / 1000; 
                const utilFunds = (covered * sc.rate);
                
                totalUtilizedRice += utilRice;
                totalUtilizedFunds += utilFunds;

                body.innerHTML += `
                    <tr>
                        <td style="text-align:left; font-weight:bold;">${sc.name}</td>
                        <td>${sc.roll}</td><td>${wDays}</td><td>${sDays}</td><td>${covered}</td><td>${covered}</td>
                        <td>--</td><td>--</td><td>${utilRice.toFixed(3)}</td><td>--</td>
                        <td>--</td><td>${utilFunds.toFixed(2)}</td><td>--</td><td>--</td>
                        ${idx === 0 ? `<td rowspan="3" style="font-weight:bold">${s.numCooks}</td>` : ''}
                    </tr>`;
            });

            const riceClose = (s.riceOpening + s.riceLifted) - totalUtilizedRice;
            const fundsClose = (s.fundsOpening + s.fundsReceived) - totalUtilizedFunds;

            body.innerHTML += `
                <tr style="font-weight:bold; background:#f2f2f2;">
                    <td>TOTAL</td>
                    <td>${s.ppRoll + s.pRoll}</td><td>--</td><td>--</td><td>--</td><td>--</td>
                    <td>${s.riceOpening.toFixed(3)}</td>
                    <td>${s.riceLifted.toFixed(3)}</td>
                    <td>${totalUtilizedRice.toFixed(3)}</td>
                    <td>${riceClose.toFixed(3)}</td>
                    <td>${s.fundsOpening.toFixed(2)}</td>
                    <td>${totalUtilizedFunds.toFixed(2)}</td>
                    <td>${s.fundsReceived.toFixed(2)}</td>
                    <td>${fundsClose.toFixed(2)}</td>
                </tr>`;
        }

        function resetData() { if(confirm("Reset EVERYTHING?")) { localStorage.clear(); location.reload(); } }
    </script>
</body>
</html>
            
                                
                
