<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | GPS Pethgam</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-b from-emerald-900 to-blue-700 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white w-full max-w-md rounded-[2.5rem] shadow-2xl p-8 pt-10">
        <div class="text-center mb-6">
            <h1 class="text-3xl font-black text-slate-800">ERP PORTAL</h1>
            <p class="text-slate-500 font-bold text-xs uppercase">GPS Pethgam Wagoora</p>
        </div>

        <div class="flex bg-slate-100 rounded-2xl p-1 mb-6">
            <button id="staffTab" class="flex-1 py-3 rounded-xl font-bold transition-all bg-emerald-800 text-white">STAFF</button>
            <button id="adminTab" class="flex-1 py-3 rounded-xl font-bold transition-all text-slate-400 bg-transparent">ADMIN</button>
        </div>

        <div class="space-y-4">
            <input type="email" id="email" placeholder="Email Address" class="w-full bg-slate-50 p-4 rounded-2xl outline-none focus:ring-2 focus:ring-emerald-500">
            <input type="password" id="password" placeholder="Password" class="w-full bg-slate-50 p-4 rounded-2xl outline-none focus:ring-2 focus:ring-emerald-500">
            <button id="loginBtn" class="w-full bg-emerald-700 text-white font-black py-4 rounded-2xl shadow-lg hover:bg-emerald-800 transition-all">SIGN IN</button>
        </div>
        <p id="errorMsg" class="mt-4 text-red-500 text-center font-bold text-sm hidden"></p>
    </div>

    <script type="module">
        import { auth, db } from './init-firebase.js';
        import { signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        let role = 'staff';
        const sTab = document.getElementById('staffTab');
        const aTab = document.getElementById('adminTab');

        // Logic to switch tabs visually
        sTab.addEventListener('click', () => {
            role = 'staff';
            sTab.className = "flex-1 py-3 rounded-xl font-bold bg-emerald-800 text-white";
            aTab.className = "flex-1 py-3 rounded-xl font-bold text-slate-400 bg-transparent";
        });

        aTab.addEventListener('click', () => {
            role = 'admin';
            aTab.className = "flex-1 py-3 rounded-xl font-bold bg-emerald-800 text-white";
            sTab.className = "flex-1 py-3 rounded-xl font-bold text-slate-400 bg-transparent";
        });

        document.getElementById('loginBtn').addEventListener('click', async () => {
            const email = document.getElementById('email').value.trim().toLowerCase();
            const password = document.getElementById('password').value;
            const err = document.getElementById('errorMsg');

            try {
                const userCred = await signInWithEmailAndPassword(auth, email, password);
                const q = query(collection(db, "staffRecords"), where("email", "==", email));
                const snap = await getDocs(q);

                if (snap.empty) throw new Error("No database record found.");
                const data = snap.docs[0].data();

                if (data.role.toLowerCase() === role) {
                    window.location.replace("index.html");
                } else {
                    throw new Error(`Select ${data.role.toUpperCase()} tab to login.`);
                }
            } catch (e) {
                err.innerText = e.message;
                err.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>
    
