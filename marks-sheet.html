<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Report Card - GPS Pethgam Wagoora</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @page { size: A4 landscape; margin: 5mm; }
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 10px; background: #ccc; }
        
        .printable-area {
            width: 287mm; /* A4 Landscape width minus margins */
            height: 200mm;
            background: white;
            margin: auto;
            border: 4px solid #5a3d8c;
            padding: 5px;
            box-sizing: border-box;
        }

        /* Header Styling matching the image */
        .school-header { background: #5a3d8c; color: white; display: flex; align-items: center; padding: 5px; text-align: center; position: relative; }
        .school-logo { width: 70px; height: 70px; background: white; border-radius: 50%; padding: 5px; margin-right: 15px; }
        .header-text { flex-grow: 1; }
        .header-text h1 { margin: 0; font-size: 26px; letter-spacing: 2px; }
        .header-text h2 { margin: 0; font-size: 20px; font-weight: normal; }

        /* Tables and Layout */
        table { width: 100%; border-collapse: collapse; font-size: 11px; margin-top: 5px; }
        th, td { border: 1px solid #444; padding: 3px; text-align: center; }
        .label-cell { background: #e1f5fe; text-align: left; font-weight: bold; width: 120px; }
        .data-cell { width: 150px; }
        
        .subject-table th { background: #dcd0ff; }
        .subject-name { text-align: left; font-weight: bold; padding-left: 10px; color: #b71c1c; }

        /* Keys and Results Grid */
        .summary-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; margin-top: 5px; height: 180px;}
        .section-box { border: 1px solid #444; }
        .section-header { background: #5a3d8c; color: white; font-weight: bold; padding: 3px; }
        
        /* Proficiency Checkboxes */
        .prof-row { display: flex; justify-content: space-between; padding: 5px; border-bottom: 1px solid #eee; }
        .check-mark { font-weight: bold; font-size: 16px; color: green; }

        /* Chart Area */
        .graph-section { display: flex; border: 1px solid #444; margin-top: 5px; height: 180px; }
        .chart-container { width: 45%; padding: 5px; border-right: 1px solid #444; }
        .remarks-box { width: 25%; padding: 10px; font-size: 12px; border-right: 1px solid #444; }
        .co-scholastic { width: 30%; }

        .footer-sigs { display: grid; grid-template-columns: repeat(4, 1fr); margin-top: 15px; text-align: center; }
        .sig-line { border-top: 1px solid #000; padding-top: 3px; font-size: 11px; font-weight: bold; background: #37474f; color: white; }

        .btn-download { position: fixed; bottom: 20px; right: 20px; padding: 10px 20px; background: darkgreen; color: white; border: none; cursor: pointer; border-radius: 5px; }
        @media print { .btn-download { display: none; } body { background: white; padding: 0; } }
    </style>
</head>
<body>

<div class="printable-area">
    <div class="school-header">
        <img src="logo.png" class="school-logo" alt="Logo">
        <div class="header-text">
            <h1>GOVERNMENT PRIMARY SCHOOL</h1>
            <h2>PETHGAM WAGOORA 193109</h2>
        </div>
    </div>

    <table>
        <tr>
            <td class="label-cell">Student Name:</td><td class="data-cell" id="sname"></td>
            <td class="label-cell">Adm. No:</td><td class="data-cell" id="admNo"></td>
            <td rowspan="4" style="width:100px; font-weight:bold; font-size:20px; color:#5a3d8c;">4th</td>
        </tr>
        <tr>
            <td class="label-cell">Fathers Name:</td><td id="fname"></td>
            <td class="label-cell">D.O.B:</td><td id="dob"></td>
        </tr>
        <tr>
            <td class="label-cell">Mothers Name:</td><td id="mname"></td>
            <td class="label-cell">Class:</td><td id="class"></td>
        </tr>
        <tr>
            <td class="label-cell">Academic Session:</td><td>Nov.-Dec. 2024</td>
            <td class="label-cell">Roll No:</td><td id="rollNo"></td>
        </tr>
        <tr>
            <td class="label-cell">Apaar ID:</td><td id="apaar"></td>
            <td class="label-cell">PEN No:</td><td id="pen"></td>
        </tr>
    </table>

    <table class="subject-table">
        <thead>
            <tr>
                <th>Subject</th>
                <th>FA1 (5)</th><th>FA2 (5)</th><th>FA3 (5)</th><th>FA4 (5)</th><th>FA5 (5)</th><th>FA6 (5)</th>
                <th>Total (30)</th>
                <th>Co-Curricular (20)</th>
                <th>Summative (50)</th>
                <th>Total (100)</th>
                <th>Grade</th>
                <th>Proficiency</th>
            </tr>
        </thead>
        <tbody id="marksBody"></tbody>
        <tr style="background:#e8f5e9; font-weight:bold;">
            <td>Grand Total</td>
            <td id="fa1T"></td><td id="fa2T"></td><td id="fa3T"></td><td id="fa4T"></td><td id="fa5T"></td><td id="fa6T"></td>
            <td id="gt30"></td><td id="gt20"></td><td id="gt50"></td><td id="gt100"></td>
            <td id="finalGrade"></td><td id="finalProf"></td>
        </tr>
    </table>

    <div class="summary-grid">
        <div class="section-box">
            <div class="section-header" style="background:#ffeb3b; color:black;">Percentage/Grade Key</div>
            <table>
                <tr style="background:#e1f5fe;"><th>%age Scale</th><th>Grade</th></tr>
                <tr><td>>85% to 100%</td><td>A+</td></tr>
                <tr><td>>70% to 85%</td><td>A</td></tr>
                <tr><td>>55% to 70%</td><td>B</td></tr>
                <tr><td>>40% to 55%</td><td>C</td></tr>
                <tr><td>>33% to 40%</td><td>D</td></tr>
            </table>
        </div>
        <div class="section-box">
            <div class="section-header" style="background:#ef5350;">Level of Proficiency</div>
            <div class="prof-row"><span>Sky (Excellent)</span><span id="pSky"></span></div>
            <div class="prof-row"><span>Mountain (Good)</span><span id="pMtn"></span></div>
            <div class="prof-row"><span>Stream (Average)</span><span id="pStrm"></span></div>
            <div style="background:#2e7d32; color:white; padding:5px; margin-top:5px;">School Rank: <span id="sRank">17</span> | Class Rank: <span id="cRank">4</span></div>
        </div>
        <div class="section-box">
            <div class="section-header" style="background:#5a3d8c;">Final Results</div>
            <table style="margin:0;">
                <tr><td class="label-cell">Total Marks:</td><td id="resTotal"></td></tr>
                <tr><td class="label-cell">Overall %:</td><td id="resPerc"></td></tr>
                <tr><td class="label-cell">Result:</td><td id="resFinal" style="font-weight:bold;">PASS</td></tr>
                <tr><td class="label-cell">Position:</td><td style="color:red; font-weight:bold;">Promoted</td></tr>
            </table>
        </div>
    </div>

    <div class="graph-section">
        <div class="chart-container">
            <canvas id="marksChart"></canvas>
        </div>
        <div class="remarks-box">
            <div style="font-weight:bold; color:#5a3d8c; border-bottom:1px solid #ccc; margin-bottom:5px;">General Remarks</div>
            <p id="remarksText"></p>
        </div>
        <div class="co-scholastic">
            <table>
                <tr style="background:#b71c1c; color:white;"><th>Co-Scholastic</th><th>Grade</th></tr>
                <tr><td>Attendance %</td><td id="att"></td></tr>
                <tr><td>Discipline</td><td>A</td></tr>
                <tr><td>Sports</td><td>B</td></tr>
                <tr><td>Art & Craft</td><td>A</td></tr>
            </table>
        </div>
    </div>

    <div class="footer-sigs">
        <div class="sig-line">Sign. Form Teacher</div>
        <div class="sig-line">Sign. Exam I/C</div>
        <div class="sig-line">Parents Signature</div>
        <div class="sig-line">Seal & Sign. Headmaster</div>
    </div>
</div>

<button class="btn-download" onclick="window.print()">Download Marksheet (PDF)</button>

<script>
const params = new URLSearchParams(window.location.search);
const admNo = params.get("admNo");

const admissions = JSON.parse(localStorage.getItem("admissions")) || [];
const results = JSON.parse(localStorage.getItem("results")) || [];
const sInfo = admissions.find(x => x.admNo === admNo);
const sMarks = results.find(x => x.admNo === admNo);

if(sInfo && sMarks) {
    document.getElementById('sname').innerText = sInfo.studentName;
    document.getElementById('admNo').innerText = sInfo.admNo;
    document.getElementById('fname').innerText = sInfo.fatherName;
    document.getElementById('mname').innerText = sInfo.motherName;
    document.getElementById('dob').innerText = sInfo.dob;
    document.getElementById('class').innerText = sInfo.studentClass;
    document.getElementById('rollNo').innerText = sMarks.rollNo;
    document.getElementById('apaar').innerText = sInfo.apaarId || "N/A";
    document.getElementById('pen').innerText = sInfo.penId || "N/A";
    document.getElementById('remarksText').innerText = sMarks.remarks || "Performed well.";
    document.getElementById('att').innerText = sMarks.attendance + "%";

    let chartData = [];
    let gtTotal = 0;
    
    const subjects = Object.keys(sMarks.marks);
    subjects.forEach(sub => {
        const m = sMarks.marks[sub];
        const faTotal = m.fa.reduce((a, b) => a + b, 0);
        const rowTotal = faTotal + m.cca + m.sa;
        gtTotal += rowTotal;
        chartData.push(rowTotal);

        const grade = rowTotal > 85 ? 'A+' : rowTotal > 70 ? 'A' : rowTotal > 55 ? 'B' : 'C';
        const prof = rowTotal > 70 ? 'Sky' : rowTotal > 45 ? 'Mountain' : 'Stream';

        document.getElementById('marksBody').innerHTML += `
            <tr>
                <td class="subject-name">${sub}</td>
                <td>${m.fa[0]}</td><td>${m.fa[1]}</td><td>${m.fa[2]}</td>
                <td>${m.fa[3]}</td><td>${m.fa[4]}</td><td>${m.fa[5]}</td>
                <td>${faTotal}</td><td>${m.cca}</td><td>${m.sa}</td>
                <td style="font-weight:bold">${rowTotal}</td><td>${grade}</td><td>${prof}</td>
            </tr>`;
    });

    const perc = Math.round(gtTotal / 5);
    document.getElementById('resTotal').innerText = gtTotal + " / 500";
    document.getElementById('resPerc').innerText = perc + "%";
    
    // Set Proficiency Checkboxes
    if(perc > 70) document.getElementById('pSky').innerHTML = "✓";
    else if(perc > 45) document.getElementById('pMtn').innerHTML = "✓";
    else document.getElementById('pStrm').innerHTML = "✓";

    // Initialize Bar Graph
    new Chart(document.getElementById('marksChart'), {
        type: 'bar',
        data: {
            labels: subjects,
            datasets: [{
                label: 'Subject Wise Performance',
                data: chartData,
                backgroundColor: '#5c6bc0'
            }]
        },
        options: { scales: { y: { beginAtZero: true, max: 100 } } }
    });
}
</script>
</body>
</html>
      
