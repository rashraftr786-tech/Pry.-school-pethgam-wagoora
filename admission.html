<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Step 1: Student Admission Input - Government Primary School Pethgam Wagoora</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        :root { --primary: #2e7d32; --accent: #ffeb3b; --text: #333; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #e8f5e9; padding: 20px; color: var(--text); }
        .input-card { max-width: 900px; margin: auto; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; border: 1px solid #ccc; }
        
        .banner { background: var(--primary); color: white; padding: 25px; text-align: center; position: relative; }
        .banner img.logo { width: 120px; position: absolute; left: 10px; top: 40px; }
        
        .form-body { padding: 30px; display: grid; grid-template-columns: 1fr 1fr 180px; gap: 15px; }
        .full { grid-column: span 3; }
        .half { grid-column: span 1; }
        .two-thirds { grid-column: span 2; }
        
        .section-title { grid-column: span 3; background: #f1f1f1; padding: 10px; font-weight: bold; border-left: 5px solid var(--primary); margin-top: 10px; text-transform: uppercase; font-size: 14px; }

        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 13px; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-family: inherit; }
        input:focus { border-color: var(--primary); outline: none; background: #f9fff9; }

        .photo-container { grid-column: 3; grid-row: 2 / span 5; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; }
        .photo-box { width: 150px; height: 180px; border: 2px dashed #aaa; border-radius: 8px; display: flex; align-items: center; justify-content: center; text-align: center; cursor: pointer; background: #fafafa; overflow: hidden; position: relative; }
        .photo-box img { width: 100%; height: 100%; object-fit: cover; display: none; }
        .photo-box span { font-size: 11px; color: #777; padding: 10px; }

        .declaration-box { grid-column: span 3; background: #fffde7; border: 1px solid #ffe082; padding: 20px; border-radius: 8px; margin-top: 20px; }
        .declaration-box p { font-size: 12px; line-height: 1.6; margin: 0 0 15px 0; text-align: justify; }
        .checkbox-row { display: flex; align-items: flex-start; gap: 10px; font-weight: bold; font-size: 13px; cursor: pointer; }
        .checkbox-row input { width: auto; margin-top: 3px; }

        .btn-proceed { grid-column: span 3; background: var(--primary); color: white; padding: 18px; border: none; border-radius: 8px; font-size: 18px; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.3s; }
        .btn-proceed:hover { background: #1b5e20; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
    </style>
</head>
<body>

<div class="input-card">
    <div class="banner">
        <img src="logo.png" alt="Logo" class="logo">
        <h2>GOVERNMENT PRIMARY SCHOOL PETHGAM WAGOORA</h2>
        <p>Official Digital Admission Portal - Session 2026</p>
        <p><strong>UDISE CODE</strong>  01022202207  <strong>Email</strong>  pspethgam@gmail.com  <strong>Contact</strong>  9596449881</p>
    </div>

    <form id="admForm" class="form-body">
        <div class="section-title">Step 1: Admission Type & Student Identity</div>
        
        <div class="half">
            <label>Admission Type</label>
            <select name="admType" required>
                <option value="Fresh">Fresh Admission</option>
                <option value="Transfer">Transfer Admission</option>
            </select>
        </div>

        <div class="half">
            <label>Student Name (Block Letters)</label>
            <input type="text" name="sname" required>
        </div>
        
        <div class="photo-container">
            <label>Student Photo</label>
            <div class="photo-box" onclick="document.getElementById('studentPhoto').click()">
                <span id="photoLabel">Click to upload Passport Photo</span>
                <img id="photoPreview">
            </div>
            <input type="file" id="studentPhoto" name="studentPhoto" hidden accept="image/*" onchange="previewImage(this)">
        </div>

        <div class="half">
            <label>Name As Per Aadhaar</label>
            <input type="text" name="aadhaarName" required>
        </div>
        <div class="half">
            <label>Date of Birth</label>
            <input type="date" name="dob" required>
        </div>

        <div class="half">
            <label>Father's Name</label>
            <input type="text" name="fname" required>
        </div>
        <div class="half">
            <label>Mother's Name</label>
            <input type="text" name="mname" required>
        </div>

        <div class="half">
            <label>Gender</label>
            <select name="gender" required>
                <option value="">Select Gender</option>
                <option>Male</option><option>Female</option><option>Other</option>
            </select>
        </div>
        <div class="half">
            <label>Blood Group</label>
            <select name="bloodGroup">
                <option value="">Unknown</option>
                <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
                <option>O+</option><option>O-</option><option>AB+</option><option>AB-</option>
            </select>
        </div>

        <div class="section-title">Step 2: Transfer Details & Identifiers</div>
        <div class="half"><label>APAAR ID</label><input type="text" name="apaarId" placeholder="12-digit number"></div>
        <div class="half"><label>PEN No. (Permanent Education No.)</label><input type="text" name="penNo" placeholder="For Transfer cases"></div>
        <div class="half"><label>Student Aadhaar No.</label><input type="text" name="aadhaar" maxlength="12" required></div>
        <div class="half"><label>Category</label>
            <select name="cat">
                <option>General</option><option>OBC</option><option>SC</option><option>ST</option><option>RBA</option>
            </select>
        </div>

        <div class="section-title">Step 3: Residence & Detailed Contact</div>
        <div class="half"><label>Mohallah</label><input type="text" name="mohallah" required></div>
        <div class="half"><label>Village</label><input type="text" name="village" required></div>
        <div class="half"><label>Tehsil</label><input type="text" name="tehsil" required></div>
        <div class="half"><label>PIN Code</label><input type="text" name="pincode" value="193109" required></div>
        <div class="half"><label>Father's Contact No.</label><input type="tel" name="fContact" required></div>
        <div class="half"><label>Mother's Contact No.</label><input type="tel" name="mContact"></div>

        <div class="section-title">Step 4: Bank Details</div>
        <div class="half"><label>Account Number</label><input type="text" name="bankAcc"></div>
        <div class="half"><label>Bank Name</label><input type="text" name="bankName"></div>
        <div class="half"><label>IFSC Code</label><input type="text" name="ifsc"></div>
        <div class="half"><label>Class Joining</label>
            <select name="sclass" required>
                <option>Pre-Primary 3</option><option>Pre-Primary 2</option><option>Balvatika</option>
                <option>1st</option><option>2nd</option><option>3rd</option><option>4th</option><option>5th</option>
            </select>
        </div>

        <div class="section-title">Step 5: Document Uploads</div>
        <div class="half"><label>Birth Certificate</label><input type="file" name="docBirth" required></div>
        <div class="half"><label>Blood Group Report</label><input type="file" name="docBlood"></div>
        <div class="half"><label>Aadhaar Card (Child)</label><input type="file" name="docAadhaarChild" required></div>
        <div class="half"><label>Aadhaar Card (Parent)</label><input type="file" name="docAadhaarParent" required></div>

        <div class="declaration-box">
            <p>
                <strong>Parents Declaration:</strong> I do hereby declare that the above information provided by me is true to the best of my knowledge and belief. I further declare that I will abide by the rules and regulations laid down by the school and the department from time to time. If any information is found incorrect, the school has the right to cancel the admission. I hereby declare that as the Parent of above mentioned student I am giving my consent to provide the AADHAAR for the demographic authentication of the student for educational purposes and APAAR ID generation.
            </p>
            <label class="checkbox-row">
                <input type="checkbox" name="declaration_agree" required>
                <span>I Agree to the Terms & Declaration</span>
            </label>
        </div>

        <button type="button" class="btn-proceed" onclick="proceedToApaar()">Submit Step 1 & Proceed to APAAR Form ➔</button>
    </form>
</div>

<script>
    // Helper to shrink images so they fit in browser memory
async function shrinkImage(file) {
    return new Promise((resolve) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = (e) => {
            const img = new Image();
            img.src = e.target.result;
            img.onload = () => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const maxWidth = 800; // Limit resolution for PDF
                const scale = maxWidth / img.width;
                canvas.width = maxWidth;
                canvas.height = img.height * scale;
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                resolve(canvas.toDataURL('image/jpeg', 0.7)); // 70% quality
            };
        };
    });
}

function previewImage(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('photoPreview').src = e.target.result;
            document.getElementById('photoPreview').style.display = 'block';
            document.getElementById('photoLabel').style.display = 'none';
        };
        reader.readAsDataURL(input.files[0]);
    }
}

async function proceedToApaar() {
    const form = document.getElementById('admForm');
    if (!form.checkValidity()) { form.reportValidity(); return; }

    const btn = document.querySelector('.btn-proceed');
    btn.innerText = "Processing Photos... Please Wait";
    btn.disabled = true;

    const formData = new FormData(form);
    const data = {};
    
    formData.forEach((value, key) => {
        if (!(value instanceof File)) { data[key] = value; }
    });

    // List of all file inputs to process
    const fileFields = ['studentPhoto', 'docBirth', 'docBlood', 'docAadhaarChild', 'docAadhaarParent'];
    
    try {
        for (let field of fileFields) {
            const fileInput = form.querySelector(`[name="${field}"]`);
            if (fileInput && fileInput.files[0]) {
                data[field] = await shrinkImage(fileInput.files[0]);
            }
        }
        localStorage.setItem('temp_adm', JSON.stringify(data));
        window.location.href = 'apaar-input.html';
    } catch (e) {
        alert("Memory Error: The images are too large. Please try using smaller files.");
        btn.disabled = false;
        btn.innerText = "Submit Step 1 & Proceed ➔";
    }
}

</script>

</body>
</html>
